# Diagrama de Flujo - Sistema de AutenticaciÃ³n

## Flujo de Registro de Usuario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIO   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Visita register.html
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - register.html      â”‚
â”‚                                 â”‚
â”‚  Formulario:                    â”‚
â”‚  - Nombre: [________]           â”‚
â”‚  - Email:  [________]           â”‚
â”‚  - Pass:   [________]           â”‚
â”‚  - Conf:   [________]           â”‚
â”‚                                 â”‚
â”‚  [Crear Cuenta]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Submit formulario
       â”‚ 3. Valida passwords coincidan
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   auth.js                       â”‚
â”‚                                 â”‚
â”‚  - Valida campos                â”‚
â”‚  - Preview tipo de usuario      â”‚
â”‚  - Construye JSON body          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. POST /auth/register
       â”‚    { nombre, email, password }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API GATEWAY                   â”‚
â”‚   /auth/register                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Invoke Lambda
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LAMBDA - auth.py              â”‚
â”‚   register_handler()            â”‚
â”‚                                 â”‚
â”‚  âœ“ Valida email formato         â”‚
â”‚  âœ“ Valida password longitud     â”‚
â”‚  âœ“ Verifica email Ãºnico         â”‚
â”‚  âœ“ Determina tipo usuario:      â”‚
â”‚    - @utec.edu.pe = estudiante  â”‚
â”‚    - @admin.utec.edu.pe = admin â”‚
â”‚    - otros = trabajador         â”‚
â”‚  âœ“ Hash password (SHA-256)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. PutItem
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DynamoDB - UsersTable         â”‚
â”‚                                 â”‚
â”‚  {                              â”‚
â”‚    email: "user@utec.edu.pe"    â”‚
â”‚    user_id: "uuid"              â”‚
â”‚    nombre: "Juan PÃ©rez"         â”‚
â”‚    password_hash: "sha256..."   â”‚
â”‚    tipo: "estudiante"           â”‚
â”‚    created_at: "2025-..."       â”‚
â”‚  }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Success response
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - register.html      â”‚
â”‚                                 â”‚
â”‚  âœ… Usuario registrado!         â”‚
â”‚     Tipo: estudiante            â”‚
â”‚                                 â”‚
â”‚  Redirigiendo a login...        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 8. Redirect despuÃ©s 2s
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - login.html         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de Login

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIO   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Visita login.html
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - login.html         â”‚
â”‚                                 â”‚
â”‚  Email:    [________________]   â”‚
â”‚  Password: [________________]   â”‚
â”‚                                 â”‚
â”‚  [Iniciar SesiÃ³n]               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Submit formulario
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   auth.js                       â”‚
â”‚   loginForm.submit()            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. POST /auth/login
       â”‚    { email, password }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API GATEWAY                   â”‚
â”‚   /auth/login                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Invoke Lambda
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LAMBDA - auth.py              â”‚
â”‚   login_handler()               â”‚
â”‚                                 â”‚
â”‚  1. Busca usuario por email     â”‚
â”‚  2. Hash password ingresado     â”‚
â”‚  3. Compara con hash guardado   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. GetItem by email
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DynamoDB - UsersTable         â”‚
â”‚                                 â”‚
â”‚  Retorna usuario completo       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Â¿Password correcto?
       â”‚
       â”œâ”€â”€â”€ âŒ Incorrecto
       â”‚         â”‚
       â”‚         â–¼
       â”‚    Response 401
       â”‚    "Credenciales invÃ¡lidas"
       â”‚
       â””â”€â”€â”€ âœ… Correcto
                 â”‚
                 â–¼
            Response 200
            {
              message: "Login exitoso",
              user: {
                user_id,
                email,
                nombre,
                tipo,
                created_at
              }
            }
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - auth.js            â”‚
â”‚                                 â”‚
â”‚  localStorage.setItem(          â”‚
â”‚    'currentUser',               â”‚
â”‚    JSON.stringify(user)         â”‚
â”‚  )                              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Redirect a index.html
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - index.html         â”‚
â”‚                                 â”‚
â”‚  Header:                        â”‚
â”‚  ğŸ‘¤ Juan PÃ©rez  [ESTUDIANTE]   â”‚
â”‚                  [Cerrar SesiÃ³n]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de ProtecciÃ³n de Rutas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIO   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Intenta acceder a index.html
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - index.html         â”‚
â”‚   Script: app.js                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ DOMContentLoaded event
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   app.js                        â”‚
â”‚   getCurrentUser()              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ localStorage.getItem('currentUser')
       â”‚
       â”œâ”€â”€â”€ âŒ No existe
       â”‚         â”‚
       â”‚         â–¼
       â”‚    window.location.href = 'login.html'
       â”‚    (Redirect a login)
       â”‚
       â””â”€â”€â”€ âœ… Existe
                 â”‚
                 â–¼
            Parse JSON
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   displayUserInfo(user)         â”‚
â”‚                                 â”‚
â”‚  userName.textContent =         â”‚
â”‚    "ğŸ‘¤ " + user.nombre          â”‚
â”‚                                 â”‚
â”‚  userType.className =           â”‚
â”‚    "badge-" + user.tipo         â”‚
â”‚                                 â”‚
â”‚  userType.textContent =         â”‚
â”‚    user.tipo.toUpperCase()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Usuario puede usar la app
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App funcionando normalmente   â”‚
â”‚   con informaciÃ³n de usuario    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de Logout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIO   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Click en "Cerrar SesiÃ³n"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   app.js                        â”‚
â”‚   logoutBtn.click()             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ confirm("Â¿EstÃ¡s seguro?")
       â”‚
       â”œâ”€â”€â”€ âŒ Cancelar
       â”‚         â”‚
       â”‚         â””â”€â”€â”€ No hace nada
       â”‚
       â””â”€â”€â”€ âœ… Aceptar
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   localStorage.removeItem(      â”‚
â”‚     'currentUser'               â”‚
â”‚   )                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ window.location.href = 'login.html'
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND - login.html         â”‚
â”‚   (Usuario deslogueado)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DeterminaciÃ³n de Tipo de Usuario

```
Email ingresado
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _determine_user_type(email)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ email.lower().strip()
       â”‚
       â”œâ”€â”€â”€ Â¿Termina en @admin.utec.edu.pe?
       â”‚         â”‚
       â”‚         â”œâ”€â”€â”€ âœ… SÃ­ â†’ return 'admin'
       â”‚         â”‚            ğŸ”´ Badge rojo
       â”‚         â”‚
       â”‚         â””â”€â”€â”€ âŒ No
       â”‚                   â”‚
       â”‚                   â–¼
       â”œâ”€â”€â”€ Â¿Termina en @utec.edu.pe?
       â”‚         â”‚
       â”‚         â”œâ”€â”€â”€ âœ… SÃ­ â†’ return 'estudiante'
       â”‚         â”‚            ğŸ”µ Badge azul
       â”‚         â”‚
       â”‚         â””â”€â”€â”€ âŒ No
       â”‚                   â”‚
       â”‚                   â–¼
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ return 'trabajador'
                          ğŸŸ¢ Badge verde
```

## Estructura de Datos

### localStorage
```javascript
{
  "currentUser": {
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "email": "juan@utec.edu.pe",
    "nombre": "Juan PÃ©rez",
    "tipo": "estudiante",
    "created_at": "2025-11-16T12:00:00.000Z"
  }
}
```

### DynamoDB UsersTable
```
Partition Key: email (String)

Item:
{
  "email": "juan@utec.edu.pe",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "nombre": "Juan PÃ©rez",
  "password_hash": "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8",
  "tipo": "estudiante",
  "created_at": "2025-11-16T12:00:00.000Z",
  "updated_at": "2025-11-16T12:00:00.000Z"
}
```

## Endpoints API

```
BASE_URL: https://{api-id}.execute-api.{region}.amazonaws.com/{stage}

POST /auth/register
  Body: {
    "nombre": "string",
    "email": "string",
    "password": "string"
  }
  Response 201: {
    "message": "Usuario registrado exitosamente",
    "user": {
      "user_id": "uuid",
      "email": "string",
      "nombre": "string",
      "tipo": "estudiante|trabajador|admin",
      "created_at": "timestamp"
    }
  }

POST /auth/login
  Body: {
    "email": "string",
    "password": "string"
  }
  Response 200: {
    "message": "Login exitoso",
    "user": {
      "user_id": "uuid",
      "email": "string",
      "nombre": "string",
      "tipo": "estudiante|trabajador|admin",
      "created_at": "timestamp"
    }
  }
```
